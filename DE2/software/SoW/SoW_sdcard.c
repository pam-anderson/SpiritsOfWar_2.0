/*
 * SoW_sdcard.c
 *
 *  Created on: 2015-01-27
 *      Author: Arjan
 */
#include "SoW.h"
#include "SoW_game_screen.h"

alt_up_sd_card_dev* sdcard;

int grass[] = {0x1d20, 0x1ce0, 0x1d00, 0x1d00, 0x1cc0, 0x1d00, 0x1d00, 0x1cc0, 0x1ca0, 0x1cc0, 0x1ce0, 0x1d00, 0x1ce0, 0x1d00, 0x1c60, 0x1d00,
	 0x1c80, 0x14c0, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1ce0, 0x14e0, 0x14c0, 0x1d00, 0x1cc0, 0x1ca0, 0x1cc0, 0x1ca0, 0x1c80,
	 0x1cc0, 0x1ce0, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1ce0, 0x1ce0, 0x1cc0, 0x1ce0, 0x1cc0, 0x1ca0, 0x1cc0, 0x1cc0, 0x1ca0,
	 0x1d20, 0x1d20, 0x1d20, 0x1d00, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d00, 0x1d00, 0x1cc0, 0x1cc0, 0x1ca0, 0x1ca0, 0x1cc0, 0x1cc0, 0x1ce0,
	 0x1d00, 0x1d00, 0x1d20, 0x1d00, 0x1ce0, 0x1ce0, 0x1d00, 0x1d00, 0x1d20, 0x1ce0, 0x1ca0, 0x1c80, 0x1ca0, 0x1ca0, 0x1cc0, 0x1d00,
	 0x1ce0, 0x1cc0, 0x1ce0, 0x1ce0, 0x1cc0, 0x1ce0, 0x1d00, 0x1d20, 0x1d00, 0x1ce0, 0x1c80, 0x1c60, 0x1ca0, 0x1ca0, 0x1ca0, 0x1d00,
	 0x1cc0, 0x1cc0, 0x1cc0, 0x1ca0, 0x1ca0, 0x1cc0, 0x1ce0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1ca0, 0x1ce0, 0x1d00, 0x1d20, 0x1ca0, 0x1ce0,
	 0x1cc0, 0x1ca0, 0x1cc0, 0x1ca0, 0x1ca0, 0x1d00, 0x1d00, 0x1cc0, 0x1ca0, 0x1cc0, 0x1ce0, 0x1d20, 0x1d40, 0x1d40, 0x1cc0, 0x1d20,
	 0x1ce0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1ce0, 0x1d20, 0x1d40, 0x1d60, 0x1ce1, 0x1d00,
	 0x1d40, 0x1d20, 0x1d00, 0x1cc0, 0x1d00, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d20, 0x1d40, 0x1d01, 0x1ca0,
	 0x1d40, 0x1d00, 0x1d40, 0x1cc0, 0x1cc0, 0x1d00, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d00, 0x1ce0, 0x1ce0, 0x1ca0,
	 0x1d00, 0x14a0, 0x1ce0, 0x1c80, 0x1c80, 0x1ce0, 0x1d00, 0x1d00, 0x1d00, 0x1d00, 0x1ce0, 0x1ce0, 0x1ce0, 0x1d00, 0x1ce0, 0x1c80,
	 0x14a0, 0x1cc0, 0x1ca0, 0x1c80, 0x1cc0, 0x14a0, 0x14c0, 0x1d00, 0x1d00, 0x1ce0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d00, 0x14a0,
	 0x1500, 0x1cc0, 0x1cc0, 0x1cc0, 0x1cc0, 0x14c0, 0x14c0, 0x1d00, 0x1ce0, 0x1ca0, 0x1cc0, 0x1ca0, 0x1cc0, 0x1ce0, 0x1ce0, 0x1500,
	 0x1500, 0x1500, 0x1ce0, 0x1cc0, 0x1ca0, 0x14a0, 0x1ca0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1cc0, 0x1cc0, 0x14e0, 0x14e0, 0x1500,
	 0x1d20, 0x1d00, 0x1ce0, 0x1ca0, 0x1ca0, 0x1cc0, 0x1ce0, 0x1cc0, 0x1ca0, 0x1cc0, 0x1cc0, 0x1ce0, 0x1d00, 0x1d20, 0x1ca0, 0x1d20};

int water[] = {0x353, 0x373, 0x3b5, 0x3b5, 0x3b5, 0x394, 0x394, 0x3b4, 0x3b5, 0x3b5, 0x394, 0x394, 0x394, 0x3d5, 0x3d6, 0x3f6,
		0x373, 0x374, 0x394, 0x394, 0x394, 0x373, 0x373, 0x394, 0x394, 0x394, 0x394, 0x3b4, 0x3d5, 0x3d6, 0x3b5, 0x394,
		0x3b5, 0x3b4, 0x3b4, 0x394, 0x373, 0x373, 0x353, 0x373, 0x394, 0x394, 0x394, 0x3b5, 0x3d5, 0x3d5, 0x394, 0x373,
		0x3d6, 0x3d5, 0x3b5, 0x394, 0x373, 0x373, 0x373, 0x374, 0x394, 0x3b5, 0x3b4, 0x3b5, 0x3d6, 0x3d5, 0x394, 0x373,
		0x417, 0x3d6, 0x3b5, 0x394, 0x394, 0x394, 0x394, 0x394, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3d5, 0x3d6, 0x3b5, 0x373,
		0x3f7, 0x3f7, 0x3d6, 0x3d5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3d5, 0x3b5, 0x394, 0x394, 0x394, 0x3b5, 0x3b5, 0x394,
		0x3b5, 0x3f6, 0x3d6, 0x394, 0x394, 0x394, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x394, 0x373, 0x373, 0x394, 0x394, 0x374,
		0x3b5, 0x3d5, 0x394, 0x373, 0x373, 0x373, 0x394, 0x3b5, 0x3b5, 0x3b5, 0x394, 0x373, 0x373, 0x394, 0x394, 0x353,
		0x3b5, 0x3d5, 0x394, 0x353, 0x352, 0x373, 0x394, 0x394, 0x3b5, 0x3d6, 0x3b5, 0x394, 0x394, 0x3b4, 0x394, 0x373,
		0x3d6, 0x3d5, 0x394, 0x373, 0x373, 0x373, 0x3b4, 0x3b5, 0x3b5, 0x3d6, 0x3d5, 0x3b5, 0x3b5, 0x3d6, 0x3d5, 0x394,
		0x3f6, 0x3f6, 0x3b5, 0x394, 0x394, 0x3b4, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3d5, 0x3f6, 0x3d6, 0x3b5,
		0x3d6, 0x3d6, 0x3d6, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x394, 0x373, 0x374, 0x3b5, 0x3d6, 0x3d6, 0x3d5,
		0x394, 0x3d6, 0x3d6, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x3b5, 0x394, 0x353, 0x373, 0x394, 0x3d5, 0x3d6, 0x3d5,
		0x394, 0x3d5, 0x3d6, 0x3d5, 0x3b5, 0x394, 0x394, 0x3b5, 0x3b5, 0x394, 0x374, 0x394, 0x3b5, 0x3d5, 0x3b5, 0x3b5,
		0x3b5, 0x3d6, 0x3d5, 0x3b5, 0x3b4, 0x394, 0x394, 0x3b4, 0x3b5, 0x3b4, 0x394, 0x3b5, 0x3d5, 0x3b5, 0x394, 0x394,
		0x3f6, 0x3b5, 0x394, 0x373, 0x373, 0x394, 0x3b5, 0x3b5, 0x3b5, 0x3b4, 0x3b4, 0x3b5, 0x3d5, 0x3b5, 0x3b4, 0x394};

int rock[] = { 0x6920, 0x60e0, 0x60c0, 0x68e0, 0x70e0, 0x7100, 0x7900, 0x7100, 0x68e0, 0x58c0, 0x58c0, 0x58c0, 0x60e0, 0x60e0, 0x58e0, 0x6920,
		0x60e0, 0x60e0, 0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x60c0, 0x60e0, 0x68e0, 0x60e0, 0x58c0, 0x6100,
		0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x60c0, 0x60c0, 0x60c0, 0x58c0, 0x60c0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x60c0,
		0x68e0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x58c0, 0x60c0, 0x60c0, 0x60c0, 0x60c0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x58a0,
		0x60e0, 0x60e0, 0x60e0, 0x60c0, 0x58c0, 0x58c0, 0x58c0, 0x60c0, 0x68e0, 0x68e0, 0x60c0, 0x60c0, 0x60c0, 0x60c0, 0x58c0, 0x58c0,
		0x58c0, 0x58c0, 0x58c0, 0x50c0, 0x50a0, 0x50c0, 0x58c0, 0x60e0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60e0,
		0x50c0, 0x50a0, 0x50a0, 0x50a0, 0x50a0, 0x50a0, 0x58c0, 0x60c0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x58c0, 0x60c0, 0x60c0, 0x60e0,
		0x50e0, 0x50c0, 0x58c0, 0x50c0, 0x58c0, 0x58c0, 0x60c0, 0x60c0, 0x60e0, 0x60e0, 0x60c0, 0x60c0, 0x58c0, 0x60c0, 0x60c0, 0x68e0,
		0x58c0, 0x58c0, 0x60c0, 0x60c0, 0x60c0, 0x60e0, 0x68e0, 0x68e0, 0x60c0, 0x60e0, 0x68e0, 0x68e0, 0x60e0, 0x60c0, 0x60c0, 0x68e0,
		0x58c0, 0x68e0, 0x68e0, 0x68e0, 0x60e0, 0x68e0, 0x70e0, 0x68e0, 0x60c0, 0x60c0, 0x68e0, 0x68e0, 0x68e0, 0x60c0, 0x60e0, 0x68e0,
		0x58c0, 0x68e0, 0x70e0, 0x68e0, 0x60e0, 0x60e0, 0x68e0, 0x60e0, 0x58c0, 0x60c0, 0x60e0, 0x68e0, 0x60e0, 0x60c0, 0x60c0, 0x68e0,
		0x58c0, 0x60e0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60c0, 0x60c0, 0x60c0, 0x58c0, 0x60c0, 0x60e0,
		0x58e0, 0x58c0, 0x60c0, 0x60c0, 0x58c0, 0x58c0, 0x58a0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60c0, 0x60e0, 0x68e0,
		0x50e0, 0x50a0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60c0, 0x60e0, 0x60e0, 0x60c0, 0x58c0, 0x58c0, 0x60e0, 0x68e0, 0x68e0,
		0x58e0, 0x48a0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60e0, 0x68e0, 0x68e0, 0x60c0, 0x58c0, 0x58c0, 0x60e0, 0x68e0, 0x68e0,
		0x6940, 0x58e0, 0x58c0, 0x58c0, 0x58c0, 0x58c0, 0x60e0, 0x68e0, 0x68e0, 0x68e0, 0x60e0, 0x58e0, 0x58c0, 0x60c0, 0x60e0, 0x60c0};


char **filenames[6][9] =
			{"p0c0s0.bmp", "p0c1s0.bmp", "p0c2s0.bmp", "p1c0s0.bmp", "p1c1s0.bmp", "p1c2s0.bmp", "p0c0s1.bmp", "p0c0s2.bmp", "p0c0s3.bmp",
			"p0c0s4.bmp", "p0c0s5.bmp", "p0c0s6.bmp", "p0c0s7.bmp", "p0c0s8.bmp", "p0c1s1.bmp", "p0c1s2.bmp", "p0c1s3.bmp", "p0c1s4.bmp",
			"p0c1s5.bmp", "p0c1s6.bmp", "p0c1s7.bmp", "p0c1s8.bmp", "p0c2s1.bmp", "p0c2s2.bmp", "p0c2s3.bmp", "p0c2s4.bmp", "p0c2s5.bmp",
			"p0c2s6.bmp", "p0c2s7.bmp", "p0c2s8.bmp", "p1c0s1.bmp", "p1c0s2.bmp", "p1c0s3.bmp", "p1c0s4.bmp", "p1c0s5.bmp", "p1c0s6.bmp",
			"p1c0s7.bmp", "p1c0s8.bmp", "p1c1s1.bmp", "p1c1s2.bmp", "p1c1s3.bmp", "p1c1s4.bmp", "p1c1s5.bmp", "p1c1s6.bmp", "p1c1s7.bmp",
			"p1c1s8.bmp", "p1c2s1.bmp", "p1c2s2.bmp", "p1c2s3.bmp", "p1c2s4.bmp", "p1c2s5.bmp", "p1c2s6.bmp", "p1c2s7.bmp", "p1c2s8.bmp"};


void sdcard_init() {
	sdcard = alt_up_sd_card_open_dev("/dev/sdcard");
	alt_up_sd_card_is_Present();
	alt_up_sd_card_is_FAT16();
}

void load_sprite(char *filename, int* sprite) {
	short int fd = alt_up_sd_card_fopen(filename, FALSE);
	int i = 0;
	for(i = 0; i < 54; i++) {
		 alt_up_sd_card_read(fd);
	}

	for(i = 0; i < 256; i++) {
		sprite[i] = 0;
		sprite[i] = (alt_up_sd_card_read(fd) >> 3);
		sprite[i] |= (alt_up_sd_card_read(fd) >> 2) << 5;
		sprite[i] |= (alt_up_sd_card_read(fd) >> 3) << 11;
	}

	alt_up_sd_card_fclose(fd);
}

void sprite_init() {
	int i = 0, j = 0;
	sprites = (int **) calloc(57, sizeof(int *));
	//sprites[0] = grass;
	 
	//sprites[1] = water;

	//sprites[2] = rock;

	for(i = 0; i < 57; i++) {
		sprites[i] = (int *) calloc(256, sizeof(int));
		if(i < 3) {
			for(j = 0; j < 256; j++) {
				if(i == 0) sprites[i][j] = grass[j];
				if(i == 1) sprites[i][j] = water[j];
				if(i == 2) sprites[i][j] = rock[j];
			}
		}
		else load_sprite(filenames[i - 3], sprites[i]);
	}
}

 void hardware_init() {
	int i = 0, j = 0;
	for(i = 0; i <= 8; i++) {
		IOWR_32DIRECT(DRAWER_BASE, 8, i);
		for(j = 0; j < 16 * 16; j++) {
			IOWR_32DIRECT(DRAWER_BASE, 16, sprites[i][j]);
			while(IORD_32DIRECT(DRAWER_BASE, 24) == 0) {};
		}
	}
}

void load_sprite_hardware(int ram_location, int type) {
	int j = 0;
	IOWR_32DIRECT(DRAWER_BASE, 8, ram_location);
	for(j = 0; j < 16 * 16; j++) {
		IOWR_32DIRECT(DRAWER_BASE, 16, sprites[type][j]);
		while(IORD_32DIRECT(DRAWER_BASE, 24) == 0) {};
	}
}

void load_turn(int turn) {
	int j = 9;
	int i = turn * 24 + 9;
	for(j = 9; j <= 32; j++) {
		load_sprite_hardware(j, i);
		i++;
	}
}
